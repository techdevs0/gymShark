function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

import React from 'react';
import { get, EDGE_SIDEBAR_EXPAND_DELAY } from '../utils';
import { hasAutoExpanded } from '../utils/sidebarChecker';
var Context = React.createContext({
  id: undefined,
  entered: false,
  expanded: false,
  setEntered: function setEntered() {},
  setExpanded: function setExpanded() {}
});
Context.displayName = 'SidebarCtx';
var initialState = {
  entered: false,
  expanded: false
};
export var useSidebarCtx = function useSidebarCtx() {
  return React.useContext(Context);
};
export var SidebarProvider = function SidebarProvider(_ref) {
  var id = _ref.id,
      children = _ref.children,
      config = _ref.config,
      sidebarState = _ref.sidebarState;

  var _React$useState = React.useState(initialState),
      _React$useState2 = _slicedToArray(_React$useState, 2),
      state = _React$useState2[0],
      setState = _React$useState2[1];

  var isMouseOverSidebar = React.useRef(false);
  var isAutoExpanded = hasAutoExpanded(config) && config.autoExpanded;
  var setEntered = React.useCallback(function (payload) {
    return setState(function (prevState) {
      return _extends(_extends({}, prevState), {}, {
        entered: payload
      });
    });
  }, []);
  var setExpanded = React.useCallback(function (payload) {
    return setState(function (prevState) {
      return _extends(_extends({}, prevState), {}, {
        expanded: payload
      });
    });
  }, []);
  var wrapOnMouseEnter = React.useCallback(function (paper) {
    return function () {
      if (paper && typeof paper.onMouseEnter === 'function') {
        paper.onMouseEnter.apply(paper, arguments);
      }

      if (sidebarState.collapsed && isAutoExpanded) {
        isMouseOverSidebar.current = true;
        setTimeout(function () {
          if (isMouseOverSidebar.current) {
            setExpanded(true);
          }
        }, EDGE_SIDEBAR_EXPAND_DELAY);
      }
    };
  }, [setExpanded, sidebarState.collapsed, isAutoExpanded]);
  var wrapOnMouseLeave = React.useCallback(function (paper) {
    return function () {
      if (paper && typeof paper.onMouseLeave === 'function') {
        paper.onMouseLeave.apply(paper, arguments);
      }

      isMouseOverSidebar.current = false;
      setExpanded(false);
    };
  }, [setExpanded]);
  var wrapOnEntered = React.useCallback(function (slide) {
    return function () {
      if (slide && typeof slide.onEntered === 'function') slide.onEntered.apply(slide, arguments);
      setEntered(true);
    };
  }, [setEntered]);
  var wrapOnExit = React.useCallback(function (slide) {
    return function () {
      if (slide && typeof slide.onExit === 'function') slide.onExit.apply(slide, arguments);
      setEntered(false);
    };
  }, [setEntered]);
  React.useEffect(function () {
    if (!sidebarState.collapsed) {
      setState(function (prevState) {
        return _extends(_extends({}, prevState), {}, {
          expanded: false
        });
      });
    }
  }, [sidebarState.collapsed]);
  return /*#__PURE__*/React.createElement(Context.Provider, {
    value: _extends(_extends({
      id: id
    }, state), {}, {
      setEntered: setEntered,
      setExpanded: setExpanded,
      wrapOnMouseEnter: wrapOnMouseEnter,
      wrapOnMouseLeave: wrapOnMouseLeave,
      wrapOnEntered: wrapOnEntered,
      wrapOnExit: wrapOnExit,
      inlineStyle: _extends({}, state.expanded && {
        width: get(config, ['width'])
      })
    })
  }, children);
};
export var SidebarConsumer = Context.Consumer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250ZXh0cy9TaWRlYmFyQ29udGV4dC50c3giXSwibmFtZXMiOlsiUmVhY3QiLCJnZXQiLCJFREdFX1NJREVCQVJfRVhQQU5EX0RFTEFZIiwiaGFzQXV0b0V4cGFuZGVkIiwiQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJpZCIsInVuZGVmaW5lZCIsImVudGVyZWQiLCJleHBhbmRlZCIsInNldEVudGVyZWQiLCJzZXRFeHBhbmRlZCIsImRpc3BsYXlOYW1lIiwiaW5pdGlhbFN0YXRlIiwidXNlU2lkZWJhckN0eCIsInVzZUNvbnRleHQiLCJTaWRlYmFyUHJvdmlkZXIiLCJjaGlsZHJlbiIsImNvbmZpZyIsInNpZGViYXJTdGF0ZSIsInVzZVN0YXRlIiwic3RhdGUiLCJzZXRTdGF0ZSIsImlzTW91c2VPdmVyU2lkZWJhciIsInVzZVJlZiIsImlzQXV0b0V4cGFuZGVkIiwiYXV0b0V4cGFuZGVkIiwidXNlQ2FsbGJhY2siLCJwYXlsb2FkIiwicHJldlN0YXRlIiwid3JhcE9uTW91c2VFbnRlciIsInBhcGVyIiwib25Nb3VzZUVudGVyIiwiY29sbGFwc2VkIiwiY3VycmVudCIsInNldFRpbWVvdXQiLCJ3cmFwT25Nb3VzZUxlYXZlIiwib25Nb3VzZUxlYXZlIiwid3JhcE9uRW50ZXJlZCIsInNsaWRlIiwib25FbnRlcmVkIiwid3JhcE9uRXhpdCIsIm9uRXhpdCIsInVzZUVmZmVjdCIsImlubGluZVN0eWxlIiwid2lkdGgiLCJTaWRlYmFyQ29uc3VtZXIiLCJDb25zdW1lciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSxPQUFPQSxLQUFQLE1BQWtCLE9BQWxCO0FBSUEsU0FBU0MsR0FBVCxFQUFjQyx5QkFBZCxRQUErQyxVQUEvQztBQUVBLFNBQVNDLGVBQVQsUUFBZ0MseUJBQWhDO0FBc0JBLElBQU1DLE9BQU8sR0FBR0osS0FBSyxDQUFDSyxhQUFOLENBQXlDO0FBQ3ZEQyxFQUFBQSxFQUFFLEVBQUVDLFNBRG1EO0FB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REcsT0FFQWUsS0FGQTtBQUdIWCxNQUFBQSxVQUFVLEVBQVZBLFVBSEc7QUFJSEMsTUFBQUEsV0FBVyxFQUFYQSxXQUpHO0FBS0htQixNQUFBQSxnQkFBZ0IsRUFBaEJBLGdCQUxHO0FBTUhNLE1BQUFBLGdCQUFnQixFQUFoQkEsZ0JBTkc7QUFPSEUsTUFBQUEsYUFBYSxFQUFiQSxhQVBHO0FBUUhHLE1BQUFBLFVBQVUsRUFBVkEsVUFSRztBQVNIRyxNQUFBQSxXQUFXLGVBQ0x2QixLQUFLLENBQUNaLFFBQU4sSUFBa0I7QUFDcEJvQyxRQUFBQSxLQUFLLEVBQUU1QyxHQUFHLENBQUNpQixNQUFELEVBQVMsQ0FBQyxPQUFELENBQVQ7QUFEVSxPQURiO0FBVFI7QUFEUCxLQWlCR0QsUUFqQkgsQ0FERjtBQXFCRCxDQTNGTTtBQTZGUCxPQUFPLElBQU02QixlQUFlLEdBQUcxQyxPQUFPLENBQUMyQyxRQUFoQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBEcmF3ZXJQcm9wcyB9IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL0RyYXdlcic7XG5pbXBvcnQgeyBQYXBlclByb3BzIH0gZnJvbSAnQG1hdGVyaWFsLXVpL2NvcmUvUGFwZXInO1xuaW1wb3J0IHsgU2xpZGVQcm9wcyB9IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL1NsaWRlJztcbmltcG9ydCB7IGdldCwgRURHRV9TSURFQkFSX0VYUEFORF9ERUxBWSB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IERpY3Rpb25hcnksIEVkZ2VTaWRlYmFyQ29uZmlnLCBTaWRlYmFyU3RhdGUgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBoYXNBdXRvRXhwYW5kZWQgfSBmcm9tICcuLi91dGlscy9zaWRlYmFyQ2hlY2tlcic7XG5cbnR5cGUgU2lkZWJhckNvbnRleHRWYWx1ZSA9IHtcbiAgaWQ6IHN0cmluZztcbiAgZW50ZXJlZDogYm9vbGVhbjtcbiAgZXhwYW5kZWQ6IGJvb2xlYW47XG4gIHNldEVudGVyZWQ6ICh2YWx1ZTogYm9vbGVhbikgPT4gdm9pZDtcbiAgc2V0RXhwYW5kZWQ6ICh2YWx1ZTogYm9vbGVhbikgPT4gdm9pZDtcbiAgaW5saW5lU3R5bGU/OiBEaWN0aW9uYXJ5PHN0cmluZyB8IG51bWJlcj47XG4gIHdyYXBPbk1vdXNlRW50ZXI/OiAoXG4gICAgcHJvcHM6IERyYXdlclByb3BzWydQYXBlclByb3BzJ11cbiAgKSA9PiAoLi4uYXJnczogUGFyYW1ldGVyczxQYXBlclByb3BzWydvbk1vdXNlRW50ZXInXT4pID0+IHZvaWQ7XG4gIHdyYXBPbk1vdXNlTGVhdmU/OiAoXG4gICAgcHJvcHM6IERyYXdlclByb3BzWydQYXBlclByb3BzJ11cbiAgKSA9PiAoLi4uYXJnczogUGFyYW1ldGVyczxQYXBlclByb3BzWydvbk1vdXNlTGVhdmUnXT4pID0+IHZvaWQ7XG4gIHdyYXBPbkVudGVyZWQ/OiAoXG4gICAgcHJvcHM6IERyYXdlclByb3BzWydTbGlkZVByb3BzJ11cbiAgKSA9PiAoLi4uYXJnczogUGFyYW1ldGVyczxTbGlkZVByb3BzWydvbkVudGVyZWQnXT4pID0+IHZvaWQ7XG4gIHdyYXBPbkV4aXQ/OiAoXG4gICAgcHJvcHM6IERyYXdlclByb3BzWydTbGlkZVByb3BzJ11cbiAgKSA9PiAoLi4uYXJnczogUGFyYW1ldGVyczxTbGlkZVByb3BzWydvbkV4aXQnXT4pID0+IHZvaWQ7XG59O1xuY29uc3QgQ29udGV4dCA9IFJlYWN0LmNyZWF0ZUNvbnRleHQ8U2lkZWJhckNvbnRleHRWYWx1ZT4oe1xuICBpZDogdW5kZWZpbmVkLFxuICBlbnRlcmVkOiBmYWxzZSxcbiAgZXhwYW5kZWQ6IGZhbHNlLFxuICBzZXRFbnRlcmVkOiAoKSA9PiB7fSxcbiAgc2V0RXhwYW5kZWQ6ICgpID0+IHt9LFxufSk7XG5Db250ZXh0LmRpc3BsYXlOYW1lID0gJ1NpZGViYXJDdHgnO1xuXG5jb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gIGVudGVyZWQ6IGZhbHNlLFxuICBleHBhbmRlZDogZmFsc2UsXG59O1xuXG5leHBvcnQgY29uc3QgdXNlU2lkZWJhckN0eCA9ICgpID0+IFJlYWN0LnVzZUNvbnRleHQoQ29udGV4dCk7XG5cbmV4cG9ydCBjb25zdCBTaWRlYmFyUHJvdmlkZXIgPSAoe1xuICBpZCxcbiAgY2hpbGRyZW4sXG4gIGNvbmZpZyxcbiAgc2lkZWJhclN0YXRlLFxufTogUmVhY3QuUHJvcHNXaXRoQ2hpbGRyZW48e1xuICBpZDogc3RyaW5nO1xuICBjb25maWc6IEVkZ2VTaWRlYmFyQ29uZmlnO1xuICBzaWRlYmFyU3RhdGU6IFNpZGViYXJTdGF0ZTtcbn0+KSA9PiB7XG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoaW5pdGlhbFN0YXRlKTtcbiAgY29uc3QgaXNNb3VzZU92ZXJTaWRlYmFyID0gUmVhY3QudXNlUmVmKGZhbHNlKTtcbiAgY29uc3QgaXNBdXRvRXhwYW5kZWQgPSBoYXNBdXRvRXhwYW5kZWQoY29uZmlnKSAmJiBjb25maWcuYXV0b0V4cGFuZGVkO1xuXG4gIGNvbnN0IHNldEVudGVyZWQgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICBwYXlsb2FkID0+IHNldFN0YXRlKHByZXZTdGF0ZSA9PiAoeyAuLi5wcmV2U3RhdGUsIGVudGVyZWQ6IHBheWxvYWQgfSkpLFxuICAgIFtdXG4gICk7XG4gIGNvbnN0IHNldEV4cGFuZGVkID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgcGF5bG9hZCA9PiBzZXRTdGF0ZShwcmV2U3RhdGUgPT4gKHsgLi4ucHJldlN0YXRlLCBleHBhbmRlZDogcGF5bG9hZCB9KSksXG4gICAgW11cbiAgKTtcbiAgY29uc3Qgd3JhcE9uTW91c2VFbnRlcjogU2lkZWJhckNvbnRleHRWYWx1ZVsnd3JhcE9uTW91c2VFbnRlciddID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgcGFwZXIgPT4gKC4uLmFyZ3MpID0+IHtcbiAgICAgIGlmIChwYXBlciAmJiB0eXBlb2YgcGFwZXIub25Nb3VzZUVudGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBhcGVyLm9uTW91c2VFbnRlciguLi5hcmdzKTtcbiAgICAgIH1cbiAgICAgIGlmIChzaWRlYmFyU3RhdGUuY29sbGFwc2VkICYmIGlzQXV0b0V4cGFuZGVkKSB7XG4gICAgICAgIGlzTW91c2VPdmVyU2lkZWJhci5jdXJyZW50ID0gdHJ1ZTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgaWYgKGlzTW91c2VPdmVyU2lkZWJhci5jdXJyZW50KSB7XG4gICAgICAgICAgICBzZXRFeHBhbmRlZCh0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIEVER0VfU0lERUJBUl9FWFBBTkRfREVMQVkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3NldEV4cGFuZGVkLCBzaWRlYmFyU3RhdGUuY29sbGFwc2VkLCBpc0F1dG9FeHBhbmRlZF1cbiAgKTtcbiAgY29uc3Qgd3JhcE9uTW91c2VMZWF2ZTogU2lkZWJhckNvbnRleHRWYWx1ZVsnd3JhcE9uTW91c2VMZWF2ZSddID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgcGFwZXIgPT4gKC4uLmFyZ3MpID0+IHtcbiAgICAgIGlmIChwYXBlciAmJiB0eXBlb2YgcGFwZXIub25Nb3VzZUxlYXZlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHBhcGVyLm9uTW91c2VMZWF2ZSguLi5hcmdzKTtcbiAgICAgIH1cbiAgICAgIGlzTW91c2VPdmVyU2lkZWJhci5jdXJyZW50ID0gZmFsc2U7XG4gICAgICBzZXRFeHBhbmRlZChmYWxzZSk7XG4gICAgfSxcbiAgICBbc2V0RXhwYW5kZWRdXG4gICk7XG4gIGNvbnN0IHdyYXBPbkVudGVyZWQ6IFNpZGViYXJDb250ZXh0VmFsdWVbJ3dyYXBPbkVudGVyZWQnXSA9IFJlYWN0LnVzZUNhbGxiYWNrKFxuICAgIHNsaWRlID0+ICguLi5hcmdzKSA9PiB7XG4gICAgICBpZiAoc2xpZGUgJiYgdHlwZW9mIHNsaWRlLm9uRW50ZXJlZCA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgc2xpZGUub25FbnRlcmVkKC4uLmFyZ3MpO1xuICAgICAgc2V0RW50ZXJlZCh0cnVlKTtcbiAgICB9LFxuICAgIFtzZXRFbnRlcmVkXVxuICApO1xuICBjb25zdCB3cmFwT25FeGl0OiBTaWRlYmFyQ29udGV4dFZhbHVlWyd3cmFwT25FeGl0J10gPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICBzbGlkZSA9PiAoLi4uYXJncykgPT4ge1xuICAgICAgaWYgKHNsaWRlICYmIHR5cGVvZiBzbGlkZS5vbkV4aXQgPT09ICdmdW5jdGlvbicpIHNsaWRlLm9uRXhpdCguLi5hcmdzKTtcbiAgICAgIHNldEVudGVyZWQoZmFsc2UpO1xuICAgIH0sXG4gICAgW3NldEVudGVyZWRdXG4gICk7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIXNpZGViYXJTdGF0ZS5jb2xsYXBzZWQpIHtcbiAgICAgIHNldFN0YXRlKHByZXZTdGF0ZSA9PiAoeyAuLi5wcmV2U3RhdGUsIGV4cGFuZGVkOiBmYWxzZSB9KSk7XG4gICAgfVxuICB9LCBbc2lkZWJhclN0YXRlLmNvbGxhcHNlZF0pO1xuXG4gIHJldHVybiAoXG4gICAgPENvbnRleHQuUHJvdmlkZXJcbiAgICAgIHZhbHVlPXt7XG4gICAgICAgIGlkLFxuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgc2V0RW50ZXJlZCxcbiAgICAgICAgc2V0RXhwYW5kZWQsXG4gICAgICAgIHdyYXBPbk1vdXNlRW50ZXIsXG4gICAgICAgIHdyYXBPbk1vdXNlTGVhdmUsXG4gICAgICAgIHdyYXBPbkVudGVyZWQsXG4gICAgICAgIHdyYXBPbkV4aXQsXG4gICAgICAgIGlubGluZVN0eWxlOiB7XG4gICAgICAgICAgLi4uKHN0YXRlLmV4cGFuZGVkICYmIHtcbiAgICAgICAgICAgIHdpZHRoOiBnZXQoY29uZmlnLCBbJ3dpZHRoJ10pLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfX1cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9Db250ZXh0LlByb3ZpZGVyPlxuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IFNpZGViYXJDb25zdW1lciA9IENvbnRleHQuQ29uc3VtZXI7XG4iXX0=