function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

import React from 'react';
import cx from 'clsx';
import { makeStyles, useTheme } from '@material-ui/core/styles';
import SwipeableDrawer from '@material-ui/core/SwipeableDrawer';
import { SidebarProvider, SidebarConsumer, useWindowCtx } from '../../contexts';
import { useBreakpointConfig, useSidebarAutoCollapse, useSidebar } from '../../hooks';
import getEdgeHeaderOffset from '../EdgeHeaderOffset';
import { CLS, createSwipeableVariant } from '../Shared/SharedSidebar';
import { get, createBreakpointStyles, createHiddenStyles } from '../../utils';
import { transitionStyles } from '../../styles';
import { generateStyledProxyCreator } from '../Shared/StyledProxy';
export default (function (styled) {
  var styledProxy = generateStyledProxyCreator(styled);
  var StyledSwipeableDrawer = styledProxy(SwipeableDrawer, CLS);
  var EdgeHeaderOffset = getEdgeHeaderOffset(styled);
  var TemporarySwipeableDrawer = createSwipeableVariant('temporary', StyledSwipeableDrawer);
  var PermanentSwipeableDrawer = createSwipeableVariant('permanent', StyledSwipeableDrawer);
  var PersistentSwipeableDrawer = createSwipeableVariant('persistent', StyledSwipeableDrawer);
  var useTransitionStyles = makeStyles(transitionStyles);

  var SwipeableSidebar = function SwipeableSidebar(_ref) {
    var onClose = _ref.onClose,
        onOpen = _ref.onOpen,
        children = _ref.children,
        PaperProps = _ref.PaperProps,
        ModalProps = _ref.ModalProps,
        SlideProps = _ref.SlideProps,
        props = _objectWithoutProperties(_ref, ["onClose", "onOpen", "children", "PaperProps", "ModalProps", "SlideProps"]);

    var sidebarId = props.sidebarId;
    useSidebarAutoCollapse(sidebarId);

    var _useWindowCtx = useWindowCtx(),
        iDocument = _useWindowCtx.iDocument;

    var transition = useTransitionStyles();
    var theme = useTheme();
    var breakpoints = theme.breakpoints;

    var _useSidebar = useSidebar(sidebarId, 'SwipeableDrawer'),
        anchor = _useSidebar.anchor,
        edgeSidebar = _useSidebar.edgeSidebar,
        _useSidebar$styles = _useSidebar.styles,
        permanent = _useSidebar$styles.permanent,
        persistent = _useSidebar$styles.persistent,
        temporary = _useSidebar$styles.temporary,
        state = _useSidebar.state,
        setOpen = _useSidebar.setOpen;

    var wrappedOnOpen = function wrappedOnOpen() {
      if (typeof onOpen === 'function') onOpen.apply(void 0, arguments);
      setOpen(sidebarId, true);
    };

    var wrappedOnClose = function wrappedOnClose() {
      if (typeof onOpen === 'function') onClose.apply(void 0, arguments);
      setOpen(sidebarId, false);
    };

    var config = useBreakpointConfig(edgeSidebar.configMapById[sidebarId]);
    var headerAdjustment = /*#__PURE__*/React.createElement(EdgeHeaderOffset, {
      sidebarId: sidebarId
    });
    return /*#__PURE__*/React.createElement(SidebarProvider, {
      id: sidebarId,
      config: config,
      sidebarState: state
    }, /*#__PURE__*/React.createElement(SidebarConsumer, null, function (_ref2) {
      var entered = _ref2.entered,
          inlineStyle = _ref2.inlineStyle,
          wrapOnEntered = _ref2.wrapOnEntered,
          wrapOnExit = _ref2.wrapOnExit,
          wrapOnMouseEnter = _ref2.wrapOnMouseEnter,
          wrapOnMouseLeave = _ref2.wrapOnMouseLeave;

      var commonProps = _extends(_extends({}, props), {}, {
        PaperProps: _extends(_extends({}, PaperProps), {}, {
          style: _extends(_extends({}, get(PaperProps, 'style')), inlineStyle),
          className: cx((entered || get(config, 'variant') === 'permanent') && transition.root, get(PaperProps, 'className')),
          onMouseEnter: wrapOnMouseEnter(PaperProps),
          onMouseLeave: wrapOnMouseLeave(PaperProps)
        }),
        ModalProps: _extends({
          container: iDocument ? iDocument.body : undefined
        }, ModalProps),
        SlideProps: _extends(_extends({}, SlideProps), {}, {
          onEntered: wrapOnEntered(SlideProps),
          onExit: wrapOnExit(SlideProps)
        }),
        anchor: anchor,
        open: state.open,
        onOpen: wrappedOnOpen,
        onClose: wrappedOnClose
      });

      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(TemporarySwipeableDrawer, _extends({
        disableScrollLock: true
      }, commonProps, {
        hiddenStyles: createHiddenStyles(temporary, [permanent, persistent], breakpoints),
        styles: createBreakpointStyles(temporary, theme)
      }), children), /*#__PURE__*/React.createElement(PersistentSwipeableDrawer, _extends({}, commonProps, {
        hiddenStyles: createHiddenStyles(persistent, [temporary, permanent], breakpoints),
        styles: createBreakpointStyles(persistent, theme)
      }), headerAdjustment, children), /*#__PURE__*/React.createElement(PermanentSwipeableDrawer, _extends({}, commonProps, {
        hiddenStyles: createHiddenStyles(permanent, [temporary, persistent], breakpoints),
        styles: createBreakpointStyles(permanent, theme)
      }), headerAdjustment, children));
    }));
  };

  return SwipeableSidebar;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1N3aXBlYWJsZVNpZGViYXIvU3dpcGVhYmxlU2lkZWJhci50c3giXSwibmFtZXMiOlsiUmVhY3QiLCJjeCIsIm1ha2VTdHlsZXMiLCJ1c2VUaGVtZSIsIlN3aXBlYWJsZURyYXdlciIsIlNpZGViYXJQcm92aWRlciIsIlNpZGViYXJDb25zdW1lciIsInVzZVdpbmRvd0N0eCIsInVzZUJyZWFrcG9pbnRDb25maWciLCJ1c2VTaWRlYmFyQXV0b0NvbGxhcHNlIiwidXNlU2lkZWJhciIsImdldEVkZ2VIZWFkZXJPZmZzZXQiLCJDTFMiLCJjcmVhdGVTd2lwZWFibGVWYXJpYW50IiwiZ2V0IiwiY3JlYXRlQnJlYWtwb2ludFN0eWxlcyIsImNyZWF0ZUhpZGRlblN0eWxlcyIsInRyYW5zaXRpb25TdHlsZXMiLCJnZW5lcmF0ZVN0eWxlZFByb3h5Q3JlYXRvciIsInN0eWxlZCIsInN0eWxlZFByb3h5IiwiU3R5bGVkU3dpcGVhYmxlRHJhd2VyIiwiRWRnZUhlYWRlck9mZnNldCIsIlRlbXBvcmFyeVN3aXBlYWJsZURyYXdlciIsIlBlcm1hbmVudFN3aXBlYWJsZURyYXdlciIsIlBlcnNpc3RlbnRTd2lwZWFibGVEcmF3ZXIiLCJ1c2VUcmFuc2l0aW9uU3R5bGVzIiwiU3dpcGVhYmxlU2lkZWJhciIsIm9uQ2xvc2UiLCJvbk9wZW4iLCJjaGlsZHJlbiIsIlBhcGVyUHJvcHMiLCJNb2RhbFByb3BzIiwiU2xpZGVQcm9wcyIsInByb3BzIiwic2lkZWJhcklkIiwiaURvY3VtZW50IiwidHJhbnNpdGlvbiIsInRoZW1lIiwiYnJlYWtwb2ludHMiLCJhbmNob3IiLCJlZGdlU2lkZWJhciIsInN0eWxlcyIsInBlcm1hbmVudCIsInBlcnNpc3RlbnQiLCJ0ZW1wb3JhcnkiLCJzdGF0ZSIsInNldE9wZW4iLCJ3cmFwcGVkT25PcGVuIiwid3JhcHBlZE9uQ2xvc2UiLCJjb25maWciLCJjb25maWdNYXBCeUlkIiwiaGVhZGVyQWRqdXN0bWVudCIsImVudGVyZWQiLCJpbmxpbmVTdHlsZSIsIndyYXBPbkVudGVyZWQiLCJ3cmFwT25FeGl0Iiwid3JhcE9uTW91c2VFbnRlciIsIndyYXBPbk1vdXNlTGVhdmUiLCJjb21tb25Qcm9wcyIsInN0eWxlIiwiY2xhc3NOYW1lIiwicm9vdCIsIm9uTW91c2VFbnRlciIsIm9uTW91c2VMZWF2ZSIsImNvbnRhaW5lciIsImJvZHkiLCJ1bmRlZmluZWQiLCJvbkVudGVyZWQiLCJvbkV4aXQiLCJvcGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPQSxLQUFQLE1BQWtCLE9BQWxCO0FBQ0EsT0FBT0MsRUFBUCxNQUFlLE1BQWY7QUFDQSxTQUFTQyxVQUFULEVBQXFCQyxRQUFyQixRQUFxQywwQkFBckM7QUFDQSxPQUFPQyxlQUFQLE1BRU8sbUNBRlA7QUFHQSxTQUFTQyxlQUFULEVBQTBCQyxlQUExQixFQUEyQ0MsWUFBM0MsUUFBK0QsZ0JBQS9EO0FBQ0EsU0FDRUMsbUJBREYsRUFFRUMsc0JBRkYsRUFHRUMsVUFIRixRQUlPLGFBSlA7QUFLQSxPQUFPQyxtQkFBUCxNQUFnQyxxQkFBaEM7QUFDQSxTQUFTQyxHQUFULEVBQWNDLHNCQUFkLFFBQTRDLHlCQUE1QztBQUNBLFNBQVNDLEdBQVQsRUFBY0Msc0JBQWQsRUFBc0NDLGtCQUF0QyxRQUFnRSxhQUFoRTtBQUNBLFNBQVNDLGdCQUFULFFBQWlDLGNBQWpDO0FBRUEsU0FBU0MsMEJBQVQsUUFBMkMsdUJBQTNDO0FBRUEsZ0JBQWUsVUFBQ0MsTUFBRCxFQUFpQjtBQUM5QixNQUFNQyxXQUFXLEdBQUdGLDBCQUEwQixDQUFDQyxNQUFELENBQTlDO0FBQ0EsTUFBTUUscUJBQXFCLEdBQUdELFdBQVcsQ0FDdkNoQixlQUR1QyxFQUV2Q1EsR0FGdUMsQ0FBekM7QUFJQSxNQUFNVSxnQkFBZ0IsR0FBR1gsbUJBQW1CLENBQUNRLE1BQUQsQ0FBNUM7QUFDQSxNQUFNSSx3QkFBd0IsR0FBR1Ysc0JBQXNCLENBQ3JELFdBRHFELEVBRXJEUSxxQkFG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RE47QUFFRSxRQUFBLFlBQVksRUFBRTNDLGtCQUFrQixDQUM5QjRCLFVBRDhCLEVBRTlCLENBQUNDLFNBQUQsRUFBWUYsU0FBWixDQUY4QixFQUc5QkosV0FIOEIsQ0FGbEM7QUFPRSxRQUFBLE1BQU0sRUFBRXhCLHNCQUFzQixDQUFDNkIsVUFBRCxFQUFhTixLQUFiO0FBUGhDLFVBU0djLGdCQVRILEVBVUd0QixRQVZILENBYkYsZUF5QkUsb0JBQUMsd0JBQUQsZUFDTTZCLFdBRE47QUFFRSxRQUFBLFlBQVksRUFBRTNDLGtCQUFrQixDQUM5QjJCLFNBRDhCLEVBRTlCLENBQUNFLFNBQUQsRUFBWUQsVUFBWixDQUY4QixFQUc5QkwsV0FIOEIsQ0FGbEM7QUFPRSxRQUFBLE1BQU0sRUFBRXhCLHNCQUFzQixDQUFDNEIsU0FBRCxFQUFZTCxLQUFaO0FBUGhDLFVBU0djLGdCQVRILEVBVUd0QixRQVZILENBekJGLENBREY7QUF3Q0QsS0EvRUgsQ0FERixDQURGO0FBcUZELEdBN0hEOztBQThIQSxTQUFPSCxnQkFBUDtBQUNELENBckpEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBjeCBmcm9tICdjbHN4JztcbmltcG9ydCB7IG1ha2VTdHlsZXMsIHVzZVRoZW1lIH0gZnJvbSAnQG1hdGVyaWFsLXVpL2NvcmUvc3R5bGVzJztcbmltcG9ydCBTd2lwZWFibGVEcmF3ZXIsIHtcbiAgU3dpcGVhYmxlRHJhd2VyUHJvcHMsXG59IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL1N3aXBlYWJsZURyYXdlcic7XG5pbXBvcnQgeyBTaWRlYmFyUHJvdmlkZXIsIFNpZGViYXJDb25zdW1lciwgdXNlV2luZG93Q3R4IH0gZnJvbSAnLi4vLi4vY29udGV4dHMnO1xuaW1wb3J0IHtcbiAgdXNlQnJlYWtwb2ludENvbmZpZyxcbiAgdXNlU2lkZWJhckF1dG9Db2xsYXBzZSxcbiAgdXNlU2lkZWJhcixcbn0gZnJvbSAnLi4vLi4vaG9va3MnO1xuaW1wb3J0IGdldEVkZ2VIZWFkZXJPZmZzZXQgZnJvbSAnLi4vRWRnZUhlYWRlck9mZnNldCc7XG5pbXBvcnQgeyBDTFMsIGNyZWF0ZVN3aXBlYWJsZVZhcmlhbnQgfSBmcm9tICcuLi9TaGFyZWQvU2hhcmVkU2lkZWJhcic7XG5pbXBvcnQgeyBnZXQsIGNyZWF0ZUJyZWFrcG9pbnRTdHlsZXMsIGNyZWF0ZUhpZGRlblN0eWxlcyB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IHRyYW5zaXRpb25TdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMnO1xuaW1wb3J0IHsgRWRnZVNpZGViYXJDb25maWcgfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVN0eWxlZFByb3h5Q3JlYXRvciB9IGZyb20gJy4uL1NoYXJlZC9TdHlsZWRQcm94eSc7XG5cbmV4cG9ydCBkZWZhdWx0IChzdHlsZWQ6IGFueSkgPT4ge1xuICBjb25zdCBzdHlsZWRQcm94eSA9IGdlbmVyYXRlU3R5bGVkUHJveHlDcmVhdG9yKHN0eWxlZCk7XG4gIGNvbnN0IFN0eWxlZFN3aXBlYWJsZURyYXdlciA9IHN0eWxlZFByb3h5PFN3aXBlYWJsZURyYXdlclByb3BzPihcbiAgICBTd2lwZWFibGVEcmF3ZXIsXG4gICAgQ0xTXG4gICk7XG4gIGNvbnN0IEVkZ2VIZWFkZXJPZmZzZXQgPSBnZXRFZGdlSGVhZGVyT2Zmc2V0KHN0eWxlZCk7XG4gIGNvbnN0IFRlbXBvcmFyeVN3aXBlYWJsZURyYXdlciA9IGNyZWF0ZVN3aXBlYWJsZVZhcmlhbnQoXG4gICAgJ3RlbXBvcmFyeScsXG4gICAgU3R5bGVkU3dpcGVhYmxlRHJhd2VyXG4gICk7XG4gIGNvbnN0IFBlcm1hbmVudFN3aXBlYWJsZURyYXdlciA9IGNyZWF0ZVN3aXBlYWJsZVZhcmlhbnQoXG4gICAgJ3Blcm1hbmVudCcsXG4gICAgU3R5bGVkU3dpcGVhYmxlRHJhd2VyXG4gICk7XG4gIGNvbnN0IFBlcnNpc3RlbnRTd2lwZWFibGVEcmF3ZXIgPSBjcmVhdGVTd2lwZWFibGVWYXJpYW50KFxuICAgICdwZXJzaXN0ZW50JyxcbiAgICBTdHlsZWRTd2lwZWFibGVEcmF3ZXJcbiAgKTtcblxuICBjb25zdCB1c2VUcmFuc2l0aW9uU3R5bGVzID0gbWFrZVN0eWxlcyh0cmFuc2l0aW9uU3R5bGVzKTtcblxuICBjb25zdCBTd2lwZWFibGVTaWRlYmFyID0gKHtcbiAgICBvbkNsb3NlLFxuICAgIG9uT3BlbixcbiAgICBjaGlsZHJlbixcbiAgICBQYXBlclByb3BzLFxuICAgIE1vZGFsUHJvcHMsXG4gICAgU2xpZGVQcm9wcyxcbiAgICAuLi5wcm9wc1xuICB9OiBPbWl0PFN3aXBlYWJsZURyYXdlclByb3BzLCAndmFyaWFudCcgfCAnb3BlbicgfCAnb25DbG9zZScgfCAnb25PcGVuJz4gJiB7XG4gICAgc2lkZWJhcklkOiBzdHJpbmc7XG4gICAgb25DbG9zZT86IFN3aXBlYWJsZURyYXdlclByb3BzWydvbkNsb3NlJ107XG4gICAgb25PcGVuPzogU3dpcGVhYmxlRHJhd2VyUHJvcHNbJ29uT3BlbiddO1xuICB9KSA9PiB7XG4gICAgY29uc3QgeyBzaWRlYmFySWQgfSA9IHByb3BzO1xuICAgIHVzZVNpZGViYXJBdXRvQ29sbGFwc2Uoc2lkZWJhcklkKTtcbiAgICBjb25zdCB7IGlEb2N1bWVudCB9ID0gdXNlV2luZG93Q3R4KCk7XG4gICAgY29uc3QgdHJhbnNpdGlvbiA9IHVzZVRyYW5zaXRpb25TdHlsZXMoKTtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgeyBicmVha3BvaW50cyB9ID0gdGhlbWU7XG4gICAgY29uc3Qge1xuICAgICAgYW5jaG9yLFxuICAgICAgZWRnZVNpZGViYXIsXG4gICAgICBzdHlsZXM6IHsgcGVybWFuZW50LCBwZXJzaXN0ZW50LCB0ZW1wb3JhcnkgfSxcbiAgICAgIHN0YXRlLFxuICAgICAgc2V0T3BlbixcbiAgICB9ID0gdXNlU2lkZWJhcihzaWRlYmFySWQsICdTd2lwZWFibGVEcmF3ZXInKTtcbiAgICBjb25zdCB3cmFwcGVkT25PcGVuOiBTd2lwZWFibGVEcmF3ZXJQcm9wc1snb25PcGVuJ10gPSAoLi4uYXJncykgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBvbk9wZW4gPT09ICdmdW5jdGlvbicpIG9uT3BlbiguLi5hcmdzKTtcbiAgICAgIHNldE9wZW4oc2lkZWJhcklkLCB0cnVlKTtcbiAgICB9O1xuICAgIGNvbnN0IHdyYXBwZWRPbkNsb3NlOiBTd2lwZWFibGVEcmF3ZXJQcm9wc1snb25DbG9zZSddID0gKC4uLmFyZ3MpID0+IHtcbiAgICAgIGlmICh0eXBlb2Ygb25PcGVuID09PSAnZnVuY3Rpb24nKSBvbkNsb3NlKC4uLmFyZ3MpO1xuICAgICAgc2V0T3BlbihzaWRlYmFySWQsIGZhbHNlKTtcbiAgICB9O1xuICAgIGNvbnN0IGNvbmZpZyA9IHVzZUJyZWFrcG9pbnRDb25maWc8RWRnZVNpZGViYXJDb25maWc+KFxuICAgICAgZWRnZVNpZGViYXIuY29uZmlnTWFwQnlJZFtzaWRlYmFySWRdXG4gICAgKTtcblxuICAgIGNvbnN0IGhlYWRlckFkanVzdG1lbnQgPSA8RWRnZUhlYWRlck9mZnNldCBzaWRlYmFySWQ9e3NpZGViYXJJZH0gLz47XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFNpZGViYXJQcm92aWRlciBpZD17c2lkZWJhcklkfSBjb25maWc9e2NvbmZpZ30gc2lkZWJhclN0YXRlPXtzdGF0ZX0+XG4gICAgICAgIDxTaWRlYmFyQ29uc3VtZXI+XG4gICAgICAgICAgeyh7XG4gICAgICAgICAgICBlbnRlcmVkLFxuICAgICAgICAgICAgaW5saW5lU3R5bGUsXG4gICAgICAgICAgICB3cmFwT25FbnRlcmVkLFxuICAgICAgICAgICAgd3JhcE9uRXhpdCxcbiAgICAgICAgICAgIHdyYXBPbk1vdXNlRW50ZXIsXG4gICAgICAgICAgICB3cmFwT25Nb3VzZUxlYXZlLFxuICAgICAgICAgIH0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1vblByb3BzID0ge1xuICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgICAgUGFwZXJQcm9wczoge1xuICAgICAgICAgICAgICAgIC4uLlBhcGVyUHJvcHMsXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgIC4uLmdldChQYXBlclByb3BzLCAnc3R5bGUnKSxcbiAgICAgICAgICAgICAgICAgIC4uLmlubGluZVN0eWxlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBjeChcbiAgICAgICAgICAgICAgICAgIChlbnRlcmVkIHx8IGdldChjb25maWcsICd2YXJpYW50JykgPT09ICdwZXJtYW5lbnQnKSAmJlxuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uLnJvb3QsXG4gICAgICAgICAgICAgICAgICBnZXQoUGFwZXJQcm9wcywgJ2NsYXNzTmFtZScpXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6IHdyYXBPbk1vdXNlRW50ZXIoUGFwZXJQcm9wcyksXG4gICAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlOiB3cmFwT25Nb3VzZUxlYXZlKFBhcGVyUHJvcHMpLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBNb2RhbFByb3BzOiB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBpRG9jdW1lbnQgPyBpRG9jdW1lbnQuYm9keSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAuLi5Nb2RhbFByb3BzLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBTbGlkZVByb3BzOiB7XG4gICAgICAgICAgICAgICAgLi4uU2xpZGVQcm9wcyxcbiAgICAgICAgICAgICAgICBvbkVudGVyZWQ6IHdyYXBPbkVudGVyZWQoU2xpZGVQcm9wcyksXG4gICAgICAgICAgICAgICAgb25FeGl0OiB3cmFwT25FeGl0KFNsaWRlUHJvcHMpLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhbmNob3IsXG4gICAgICAgICAgICAgIG9wZW46IHN0YXRlLm9wZW4sXG4gICAgICAgICAgICAgIG9uT3Blbjogd3JhcHBlZE9uT3BlbixcbiAgICAgICAgICAgICAgb25DbG9zZTogd3JhcHBlZE9uQ2xvc2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICA8VGVtcG9yYXJ5U3dpcGVhYmxlRHJhd2VyXG4gICAgICAgICAgICAgICAgICBkaXNhYmxlU2Nyb2xsTG9ja1xuICAgICAgICAgICAgICAgICAgey4uLmNvbW1vblByb3BzfVxuICAgICAgICAgICAgICAgICAgaGlkZGVuU3R5bGVzPXtjcmVhdGVIaWRkZW5TdHlsZXMoXG4gICAgICAgICAgICAgICAgICAgIHRlbXBvcmFyeSxcbiAgICAgICAgICAgICAgICAgICAgW3Blcm1hbmVudCwgcGVyc2lzdGVudF0sXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnRzXG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgc3R5bGVzPXtjcmVhdGVCcmVha3BvaW50U3R5bGVzKHRlbXBvcmFyeSwgdGhlbWUpfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgICA8L1RlbXBvcmFyeVN3aXBlYWJsZURyYXdlcj5cbiAgICAgICAgICAgICAgICA8UGVyc2lzdGVudFN3aXBlYWJsZURyYXdlclxuICAgICAgICAgICAgICAgICAgey4uLmNvbW1vblByb3BzfVxuICAgICAgICAgICAgICAgICAgaGlkZGVuU3R5bGVzPXtjcmVhdGVIaWRkZW5TdHlsZXMoXG4gICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlbnQsXG4gICAgICAgICAgICAgICAgICAgIFt0ZW1wb3JhcnksIHBlcm1hbmVudF0sXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnRzXG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgc3R5bGVzPXtjcmVhdGVCcmVha3BvaW50U3R5bGVzKHBlcnNpc3RlbnQsIHRoZW1lKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7aGVhZGVyQWRqdXN0bWVudH1cbiAgICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgICA8L1BlcnNpc3RlbnRTd2lwZWFibGVEcmF3ZXI+XG4gICAgICAgICAgICAgICAgPFBlcm1hbmVudFN3aXBlYWJsZURyYXdlclxuICAgICAgICAgICAgICAgICAgey4uLmNvbW1vblByb3BzfVxuICAgICAgICAgICAgICAgICAgaGlkZGVuU3R5bGVzPXtjcmVhdGVIaWRkZW5TdHlsZXMoXG4gICAgICAgICAgICAgICAgICAgIHBlcm1hbmVudCxcbiAgICAgICAgICAgICAgICAgICAgW3RlbXBvcmFyeSwgcGVyc2lzdGVudF0sXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnRzXG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgc3R5bGVzPXtjcmVhdGVCcmVha3BvaW50U3R5bGVzKHBlcm1hbmVudCwgdGhlbWUpfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHtoZWFkZXJBZGp1c3RtZW50fVxuICAgICAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgICAgIDwvUGVybWFuZW50U3dpcGVhYmxlRHJhd2VyPlxuICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfX1cbiAgICAgICAgPC9TaWRlYmFyQ29uc3VtZXI+XG4gICAgICA8L1NpZGViYXJQcm92aWRlcj5cbiAgICApO1xuICB9O1xuICByZXR1cm4gU3dpcGVhYmxlU2lkZWJhcjtcbn07XG4iXX0=